<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>Social Handle Checker</title>
  <style>
    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      padding: 20px;
      background: #fafafa;
      color: #222;
    }

    h1 {
      text-align: center;
      margin-bottom: 5px;
    }

    p {
      text-align: center;
      color: #555;
    }

    .section {
      margin: 20px 0;
      padding: 15px;
      background: #fff;
      border-radius: 8px;
      border: 1px solid #e0e0e0;
    }

    label {
      font-weight: bold;
    }

    input,
    select,
    button {
      margin-top: 6px;
      margin-bottom: 12px;
      padding: 8px;
      width: 100%;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 14px;
    }

    button {
      cursor: pointer;
      background: #007bff;
      color: #fff;
      font-weight: bold;
      transition: .3s;
    }

    button:hover {
      background: #0056d2;
    }

    .radio-group {
      display: flex;
      gap: 12px;
      margin: 10px 0;
    }

    .radio-group input {
      width: auto;
    }

    #panelNames {
      display: none;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 15px;
    }

    th,
    td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
    }

    th {
      background: #eee;
    }

    .true {
      color: green;
    }

    .false {
      color: red;
    }

    .filters {
      margin-top: 14px;
      text-align: right;
    }
  </style>
</head>

<body>

  <h1>Social Handle Availability Checker</h1>
  <p>Upload names or enter manually → select platforms → get results.</p>

  <div class="section">
    <label>Select Input Type</label>
    <select id="inputType" onchange="onInputTypeChange()">
      <option value="">-- Select --</option>
      <option value="txt">TXT (one name per line)</option>
      <option value="excel">Excel (.xlsx)</option>
      <option value="panel">Manual Entry Panel</option>
    </select>

    <div id="fileUpload">
      <input type="file" id="fileInput" />

      <div id="formatPreview" class="format-preview" style="display:none;">
        <strong>Example format</strong>
        <pre id="previewContent"></pre>
      </div>
    </div>

    <div id="panelNames">
      <label>Enter Names (one per line)</label>
      <textarea id="textList" rows="6" style="width:100%;"></textarea>
    </div>

    <div class="section">
      <label>Select Platforms to Check</label>
      <div class="radio-group">
        <div><input type="checkbox" class="platform" value="instagram" checked> Instagram</div>
        <div><input type="checkbox" class="platform" value="youtube" checked> YouTube</div>
        <div><input type="checkbox" class="platform" value="x" checked> X (Twitter)</div>
        <div><input type="checkbox" class="platform" value="linkedin" checked> LinkedIn</div>
      </div>
    </div>

    <button id="checkBtn" onclick="process()">Check Handles</button>
    <div id="loader" class="loader"></div>

  </div>


  <div class="filters">
    <label>Show:</label>
    <select id="filterSelect" onchange="applyFilter()">
      <option value="all">All results</option>
      <option value="available-any">Available on any</option>
      <option value="instagram-only">Only Instagram available</option>
      <option value="youtube-only">Only YouTube available</option>
      <option value="x-only">Only X available</option>
      <option value="linkedin-only">Only LinkedIn available</option>
    </select>
  </div>

  <div id="output"></div>

  <script>
    function onInputTypeChange() {
      const type = document.getElementById("inputType").value;

      document.getElementById("fileUpload").style.display =
        (type === "txt" || type === "excel") ? "block" : "none";

      document.getElementById("panelNames").style.display =
        (type === "panel") ? "block" : "none";

      updateFormatPreview(type);
    }


    function updateFormatPreview(type) {
      const box = document.getElementById("formatPreview");
      const content = document.getElementById("previewContent");

      if (type === "txt") {
        box.style.display = "block";
        content.textContent =
          `Codexly
Logiqo
Thinkbit
Codezeno`;
      }
      else if (type === "excel") {
        box.style.display = "block";
        content.textContent =
          `Name
Codexly
Logiqo
Thinkbit
Codezeno`;
      }
      else {
        box.style.display = "none";
      }
    }


    async function process() {
      if (window.isChecking) return; // hard block multi-click
      window.isChecking = true;

      const btn = document.getElementById("checkBtn");
      const loader = document.getElementById("loader");

      btn.classList.add("loading");
      btn.disabled = true;
      loader.style.display = "inline-block";

      try {
        let names = getNamesSomehow(); // keep your existing logic here

        const res = await fetch("/api/check", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ names })
        });

        const data = await res.json();
        showTable(data.results);

        document.getElementById("output")
          .scrollIntoView({ behavior: "smooth" });

      } catch (err) {
        alert("Something went wrong");
        console.error(err);
      }

      loader.style.display = "none";
      btn.disabled = false;
      btn.classList.remove("loading");
      window.isChecking = false;
    }



    function showTable(data) {
      const selectedPlatforms = Array.from(
        document.querySelectorAll(".platform:checked")
      ).map(p => p.value);

      // Always include Name column
      let headers = `<th>Name</th>`;
      selectedPlatforms.forEach(p => {
        headers += `<th>${capitalize(p)}</th>`;
      });

      let rows = "";

      data.forEach(r => {
        let row = `<td>${r.name}</td>`;

        selectedPlatforms.forEach(p => {
          const val = r[p];
          row += `<td class="${val ? "true" : "false"}">${val}</td>`;
        });

        rows += `<tr>${row}</tr>`;
      });

      document.getElementById("output").innerHTML = `
    <table>
      <tr>${headers}</tr>
      ${rows}
    </table>
  `;
    }


    function applyFilter() {
      const filter = document.getElementById("filterSelect").value;
      const filtered = window.latestResults.filter(r => {
        if (filter === "all") return true;
        if (filter === "available-any") return (r.instagram || r.youtube || r.x || r.linkedin);
        if (filter === "instagram-only") return r.instagram && !r.youtube && !r.x && !r.linkedin;
        if (filter === "youtube-only") return r.youtube && !r.instagram && !r.x && !r.linkedin;
        if (filter === "x-only") return r.x && !r.instagram && !r.youtube && !r.linkedin;
        if (filter === "linkedin-only") return r.linkedin && !r.instagram && !r.youtube && !r.x;
        return true;
      });
      showTable(filtered);
    }
  </script>

</body>

</html>